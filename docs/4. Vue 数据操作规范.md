# Vue æ•°æ®æ“ä½œè§„èŒƒ



*by wangjianyang 2017-04-28*



## ä¸€ã€ç»„ä»¶å†… Promise ä¼ å‚

å¦‚æœæ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆ**Number/String/Boolean**ï¼‰ï¼Œå¯ä»¥ç›´æ¥èµ‹å€¼ä¼ é€’ï¼Œæ¯”å¦‚ï¼š

```js
this.testService(id).then().catch();
```

or

```js
this.testService({
  	id,
  	name,
}).then().catch();
```



----



å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼ˆ**Object/Array**ï¼‰ï¼Œç”±äº JS çš„**å¼•ç”¨ä¼ é€’**ç‰¹æ€§ï¼Œéœ€è¦**å¤åˆ¶**åå†ä¼ ï¼Œå¦åˆ™å®¹æ˜“å‡ºç°å¼‚æ­¥æœŸé—´ä¼ é€’æ•°æ®è¢«ç¯¡æ”¹çš„é—®é¢˜ï¼Œå¦‚ä½•å¤åˆ¶ï¼Ÿæ ¹æ®ä»¥ä¸‹æƒ…å†µè€ƒè™‘ï¼š

#### 1. ç®€å•å¯¹è±¡/æ•°ç»„

æ²¡æœ‰åµŒå¥—çš„å¯¹è±¡å³ä¸ºç®€å•å¯¹è±¡ï¼Œå®ƒä»¬åªæœ‰å•å±‚é”®å€¼å¯¹ï¼Œæ¯”å¦‚ï¼š

```js
// Object
{
  	id: '001',
    name: 'dylan',
}
    
// Array
['dylan', 'xylen', 'jacky']
```

ç®€å•å¯¹è±¡å¯ä»¥é€šè¿‡ `Object.assign()` è¿›è¡Œ**å¤åˆ¶**ï¼š

```js
const testObj = {
  	id: '001',
    name: 'dylan',  	
};

this.testService(Object.assign({}, testObj)).then().catch();
```

ç®€å•æ•°ç»„å¯ä»¥é€šè¿‡ `[...array]` è¿›è¡Œ**å¤åˆ¶**ï¼š

```js
const testArr = ['dylan', 'xylen', 'jacky'];

this.testService([...testArr]).then().catch();
```



----



#### 2. å¤æ‚å¯¹è±¡

éå•å±‚é”®å€¼å¯¹çš„å¯¹è±¡/æ•°ç»„éƒ½æ˜¯å¤æ‚å¯¹è±¡ï¼Œæ¯”å¦‚ï¼š

```js
// Object
{
  	id: '001',
    name: 'dylan',
    devices: {
      	iPhone: '6s Plus',
        MacBook: 'Pro',
    }
}
  
// Array
['dylan', 
 'xylen', {
  	id: '003',
   	name: 'jacky',
}, {
  	id: '004',
  	name: 'mark',
  	pets: ['dog', 'cat'],
}]
```

è¿™ç§å¤æ‚çš„å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©ç¬¬ä¸‰æ–¹åº“è½»æ¾å®ç°**å¤åˆ¶**ï¼Œé¡¹ç›®é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ `lodash`ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š

```js
import { cloneDeep } from 'lodash';

const testObj = {
  	id: '001',
    name: 'dylan',
    devices: {
      	iPhone: '6s Plus',
        MacBook: 'Pro',
    }
}

this.testService(cloneDeep(testObj)).then().catch();
```

é™„ä¸Šå®˜æ–¹æ–‡æ¡£è¯´æ˜ï¼š[lodash - cloneDeep](https://lodash.com/docs/#cloneDeep)



## äºŒã€ä¿®æ”¹ç»„ä»¶å†… data/props æ•°æ®

æˆ‘ä»¬çº¦å®šï¼Œåœ¨ç»„ä»¶å†…ï¼Œæ‰€æœ‰å¯¹äº data/props æ•°æ®çš„ä¿®æ”¹ï¼Œéƒ½å¿…é¡»é€šè¿‡ `this.$set()` å®Œæˆï¼Œè€Œä¸æ˜¯ç›´æ¥çš„èµ‹å€¼æ“ä½œ `=`ï¼Œè¿™æ˜¯ä¸ºäº†é¿å…éº»çƒ¦çš„åŒå‘ç»‘å®šé—®é¢˜å‘ç”Ÿï¼Œå…·ä½“å†™æ³•å¦‚ä¸‹ï¼š

```js
export default {
    data() {
        return {
            id: '001',
            name: 'dylan',
            devices: {
                iPhone: '6s Plus',
                MacBook: 'Pro',
            },
        }
    },
  	methods: {
      	changeId() {
        	const id = 'A01';
          	this.$set(this, 'id', id);
      	},
  		changeiPhone() {
          	const iPhone = 'iPhone 8';
          	this.$set(this.devices, 'iPhone', iPhone);
  		},
      	updateDevices() {
          	const newDevices = {
                Android: 'Galaxy S8',
                Laptop: 'Chromebook',              	
          	}
            this.$set(this, 'devices', newDevices);
      	},
  	},
};
```

æ³¨æ„ï¼Œéœ€è¦**å¤åˆ¶**çš„æ•°æ®è®°å¾—è¦**å¤åˆ¶**åå†èµ‹å€¼ã€‚



## ä¸‰ã€ä¿®æ”¹ Store å†…æ•°æ®

Vuex Store å†…çš„æ•°æ®ä¿®æ”¹æ˜¯æœ€é‡è¦ï¼Œä¹Ÿæ˜¯æœ€éœ€è¦è§„èŒƒçš„åœ°æ–¹ã€‚æˆ‘ä»¬è§„å®šï¼š

1. æ‰€æœ‰çš„èµ‹å€¼æ“ä½œä¸€å¾‹ç”¨ `Vue.set()` è€Œä¸ç”¨ `=`
2. é™¤äº†åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆNumber/String/Booleanï¼‰å¤–ï¼Œå…¶å®ƒæ•°æ®éƒ½è¦ç»è¿‡**å¤åˆ¶**
   - ç®€å•å¯¹è±¡ä½¿ç”¨**æµ…å¤åˆ¶**ï¼š`Object.assign` or `[...array]`
   - å¤æ‚å¯¹è±¡ä½¿ç”¨**æ·±åº¦å¤åˆ¶**ï¼š`lodash.cloneDeep()` or `å¾ªç¯+æµ…å¤åˆ¶`ï¼ˆè¿™ä¸ªç”¨æ³•è§†å…·ä½“åœºæ™¯è€Œå®šï¼‰



ç”¨ç™»å½•æ³¨å†Œæ¨¡å—ç®€å•ä¸¾ä¾‹ä¸‹ï¼š

```js
// authorization/store.js

const initState = {
    userId: null,
    sessionId: null,
    phone: null,
    loginInfo: {},
  	arrExample: [],
};

const mutations = {
    [SIGN_IN_SUCCESS](state, { userId, sessionId, phone }) {
        Vue.set(state, 'userId', userId);
        Vue.set(state, 'sessionId', sessionId);
        Vue.set(state, 'phone', phone);
    },
    [SAVE_LOGIN_INFO](state, data) {
        Vue.set(state, 'loginInfo', Object.assign(data));
    },
    [ARR_EXAMPLE](state, arr) {
        Vue.set(state, 'arrExample', [...arr]);
    },
};
```

PSï¼šä¸åŒçš„**å¤åˆ¶**æ–¹æ³•è¯·å‚è€ƒå‰é¢æ‰€è®²ã€‚



## å››ã€å†™åœ¨æœ€å

ç”±æ•°æ®å¼•å‘çš„åŒå‘ç»‘å®š & å¼‚æ­¥ç¯¡æ”¹é—®é¢˜æ˜¯éš¾ä»¥è¿½è¸ªå’Œæ’æŸ¥çš„ï¼Œå¦‚æœä½ ä¸æƒ³ä¸ºåé¢ä¿® bug ç…è´¹è‹¦å¿ƒã€ç§¯åŠ³æˆç–¾ï¼Œå°±å¥½å¥½éµå®ˆè¿™å¥—**Vue æ•°æ®æ“ä½œè§„èŒƒ**å§ğŸ™‚